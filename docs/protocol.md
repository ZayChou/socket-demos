# 应用层协议

> 本文档描述各 socket demo 所使用的统一文本 echo 协议。

---

## 概述

所有六个 demo 均使用相同的极简**行式文本 echo 协议**，以便横向对比不同
I/O 模型的实现差异，而不是协议本身的复杂度。

---

## 消息格式

每条消息是一行 UTF-8 文本，以 `\n`（`0x0A`）结尾：

```
<text>\n
```

没有额外的长度字段或类型字节——服务端对收到的任意一行原样回显。

---

## 会话流程

```
Client                          Server
  |                               |
  |── "hello\n" ─────────────────>|
  |<── "hello\n" ────────────────|
  |                               |
  |── "ping\n" ──────────────────>|
  |<── "ping\n" ─────────────────|
  |                               |
  |── "bye\n" ───────────────────>|
  |<── "bye\n" ──────────────────|
  |                               |
 [close]                        [close]
```

---

## 关闭握手

当服务端收到以 `bye` 开头的行时：
1. 回显该行
2. 关闭连接

客户端收到 `bye\n` 的回显后主动关闭连接。

---

## 端口分配

| Demo | Port |
|------|------|
| `**/01_blocking_sync` | 9001 |
| `**/02_nonblocking_select_sync` | 9002 |
| `**/03_iocp_async` / `03_epoll` | 9003 |

---

## 错误处理

- `recv()` / `WSARecv()` 返回 0 或负数：直接关闭连接，不回显。
- `send()` / `WSASend()` 失败：打印错误，关闭连接。

